% !TeX spellcheck = ru_RU
\chapter{Обзор литературы}  \label{chapt1}

\section{Определение позы камеры}

Задача автоматического определения позы камеры в сцене исследуется давно \cite{caprile1990using}, \cite{li2010simultaneous}, \cite{liu2011surveillance} ,\cite{chen2007accurate}, \cite{pflugfelder2007people}, \cite{den2015automatic}, \cite{puwein2012ptz}, \cite{dubska2014automatic}. Её решением является метод построения отображения мировой системы координат в систему координат, связанную с камерой.

Для решения этой задачи используется информация, извлекаемая из наблюдаемой видеопоследовательности. В работе \cite{puwein2012ptz} представлен подход, получающий информацию о камере при её движении. Авторы использовали сопровождение ключевых точек при повороте камеры и изменении масштаба. Это позволило оценить фокусное расстояние камеры и направление осей мировой системы координат. В то же время большое количество камер видеонаблюдения являются статичными, то есть не изменяют своего положения и направления в сцене с течением времению. В своей работе я рассматриваю только данные, в которых камера не изменяет свою позу, то есть камера неподвижна.

Я выделяю два подхода решения задачи определения позы камеры в случае неподвижной камеры. Алгоритмы первого подхода анализируют прямые на изображении сцены для восстановления мировой системы координат, в то время, как алгоритмы второго подхода анализируют размеры объектов на изображении.

\subsection{Анализ прямых на изображении}

Ключевым предположением методов первого подхода является наблюдение, так называемого, <<Манхэттенского мира>>, то есть сцены созданной человеком, где у наблюдаемых прямых преобладают три ортогональных направления: два горизонтальных и одно вертикальное. Авторы этих работ предлагают использовать направления этих прямых в качестве направлений базисных векторов мировой системы координат. Такой выбор обусловлен тем, что из-за структуры сцены в точках схода (ТС), соответствующих этим направлениям, пересекается наибольшее количество наблюдаемых прямых. Поэтому работы первого подхода направлены на локализацию этих точке схода на изображении. Для краткости в дальнейшем точки схода, соответствующие ортогональным прямым сцены, я буду называть ортогональными. В работе \cite{caprile1990using} представлено соотношение между положением трех ортогональных точек схода (ТОТС) и фокусным расстоянием камеры. Оно послужило основой для последующих алгоритмов определения позы камеры. В работе \cite{li2010simultaneous} предлагается извлекать ортогональные прямые из изображения объектов, таких как здания. Однако предложенный метод не может быть применен в сценах, где такие структуры отсутствуют, или не все необходимые ТС могут быть найдены. Поэтому в работе \cite{dubska2014automatic} предлагается использовать видимое направление движения автомобилей по автостраде для поиска горизонтальных ТС. В работах \cite{chen2007accurate}, \cite{liu2011surveillance}, \cite{den2015automatic} предлагается использовать направление движения людей и ориентацию их изображения для поиска линии горизонта и вертикальной ТС. Авторы используют информацию о росте людей для оценки положения камеры в сцене. В работе \cite{den2015automatic} предполагается, что рост всех людей одинаков и равен 1.8 метра, в то время как авторы \cite{liu2011surveillance} используют оцененное распределение роста европейцев \cite{visscher2008sizing}.В работах \cite{chen2007accurate}, \cite{liu2011surveillance} используется ориентация областей переднего плана, соответствующих людям, для определения вертикального направления на изображении. В описанных работах люди моделируются вертикальными отрезками. Точность такой модели существенно понижается, когда направление съемки камеры отличается от горизонтального.

\subsection{Анализ размеров объектов на изображении}

Алгоритмы второго подхода анализируют распределение размеров объектов на изображении сцены. Классическим предположением этих методов является наличие единственной плоскости земли, на которой располагаются все объекты. Самым известный алгоритм этого подхода был предложен в работе \cite{hoiem2008putting}. Авторы построили вероятностную графическую графическую модель, описывающую зависимость между положением камеры и размерами объектов в сцене. Предложенный алгоритм имеет ряд существенных недостатков. Одним из ключевых является предположение высокой точности исспользуемого детектора объектов. Также авторы предполагают, что направление съемки камеры близко к горизонтальному. Это позволило авторам построить аналитическую формулу отображения положения камеры в размер объекта на изображении.

В этой работе я предлагаю алгоритм относящийся ко второму подходу. В отличие от предыдущих методов предложенных алгоритм не зависит от направления съемки камеры и может быть адаптирован для любого алгоритма поиска объектов на изображении. В своей работе я предполагаю наличие ложных обнаружений среди результатов работы детектора.

\section{Локализация объектов}

Задача построения детектора объектов на изображении всегда интересовала исследователей в области компьютерного зрения. Обычно на разрабатываемые алгоритмы накладывали требования по времени работы и количеству ложных срабатываний. Эти ограничания зачастую противоречили друг другу. Действительно, часто повышение точности классификатора окон приводит к повышению его вычислительной сложности. Для практического применения в видеонаблюдении скорость обработки данных является ключевым параметром. Поэтому многие методы разрабатывали способы понижения вычислительной сложности детекторов при сохранении их качества. Можно выделить два основных направления работы в этой области: построение быстрого классификатора и уменьшение количества рассматриваемых окон.

\subsection{Построение быстрых классификаторов}

Исторически первые работы по ускорению детектирования посвящены ускорению применяемого классификатора. Авторы \cite{viola2001rapid} предложили использовать каскад простых классификаторов для детектирования лиц на изображениях. Первые этапы каскада отбрасывают большое количество "простых" окон, не содержащих лиц. Предложенная идея оказалась настолько эффективной, что каскадные детекторы стали применяться даже в цифровых фотоаппаратах. Одним из важных недостатков такого подхода является отсутствие возможности изменять соотношение точность/полнота для уже построенного классификатора. В работе \cite{bourdev2005robust} преодолели это ограничение, изменив структуру каскада. Авторы разделили построение простых классификаторов на каждом этапе каскада и выбор границы для разделения положительных и отрицательных примеров. В работе \cite{dollar2010fastest} ускорения классификатора добились за счет вычисления признаков лишь на разреженной пирамиде изображений. На промежуточных слоях авторы предлагали восстанавливать признаки с помощью интерполяции. В этой работе я предлагаем алгоритм понижения вычислительной сложности детектора, который не зависит от типа используемого классификатора окон, поэтому его можно использовать совместно с быстрыми классификаторами.

\subsection{Уменьшение классифицируемых окон}

Другое направление по ускорению обнаружения на изображениях посвящено уменьшению количества рассматриваемых окон. Авторы работы [ CITATION dollar2012crosstalk \l 1033 ] используют корреляцию откликов классификатора в соседних окнах для выделения регионов изображения, где могут находиться объекты. Для этого они классифицируют разреженное множество окон на первых этапах обработки. В связи с существенным развитием нейросетевых алгоритмов классификации изображений \cite{krizhevsky2012imagenet}, \cite{simonyan2014very}, \cite{he2015deep}, \cite{szegedy2015rethinking} сверточные нейронные сети стали применять и для задачи обнаружения объектов на изображении. Обычно нейросетевые классификаторы требуют больших вычислительных ресурсов. Поэтому в работе \cite{girshick2014rich} было предложено классифицировать лишь небольшое подмножество выбранных окон. В работах \cite{girshick2015fast}, \cite{ren2015faster} авторы развили предыдущую идею и предложили разбить классификатор на этапы классификации и уточнение положения объекта. Это позволило увеличить размеры окон и уменьшить их количество. Наш алгоритм может быть интегрирован с любым из предложенных методов уменьшения количества обрабатываемых окон, поскольку дает априорную оценку областей, где могут находиться объекты интереса.

\section{Сопровождение объектов}

Существует два подхода к решению задачи сопровождения объектов в видеопоследовательности: визуальное сопровождение и сопровождение-через-обнаружение. Первый подход может быть применено для сопровождения объектов произвольного типа, а второй подход использует алгоритмы локализации объектов, поэтому применяется только для сопровождения объектов заданного класса, например, людей.

\subsection{Визуальное сопровождение}

Визуальное сопровождение может быть применено к локализации объектов произвольного типа на всех кадрах видеопоследовательности. Алгоритмам этого типа необходимо положение объекта на первом кадре, для построения модели объекта. На последующих кадрах происходит поиск регионов изображения, соответствующих построенной модели.

Алгоритмы визуального сопровождения различаются используемыми моделями объектов и способами определения положения объекта на последующих кадрах. Одним из методов поиска на последующих кадрах является кросс-корреляция шаблонов \cite{freeman1998computer}. При этом моделью объекта является его изображение на первом кадре. Основным достоинством данного алгоритма является высокая скорость его работы. Данный алгоритм сопровождения подходит для сопровождения только жёстких объектов, изображение которых не изменяется с течением времени. Поэтому данный алгоритм не подходит для сопровождения объектов состоящих из подвижных частей. Поэтому сопровождение объектов на основе кросс-корреляции шаблонов используется либо для сопровождения частей тела человека, либо как один из начальных этапов каскадных алгоритмов сопровождения.

Широкое распространение в визуальном сопровождении получил алгоритм, названный фильтром частиц [6]. Его особенностью является метод поиска возможных положений объекта на следующем кадре. В отличие от предыдущих методов фильтр частиц строит дискретную аппроксимацию распределения положения объекта на каждом кадре с помощью не одной гипотезы, а набора взвешенных <<частиц>>. Это позволяет восстановить положение объекта даже в ситуациях, когда на нескольких кадрах объект был потерян.

Для качественного визуального сопровождения объекта важно построение его модели, описывающей особенности сопровождаемого объекта. Одним из используемых видов модели является набор локальных особенностей (ключевых точек) изображения объекта. При этом поиск на последующих кадрах происходит не всего объекта целиком, а его ключевых точек. В работе [7] было показано, что при выборе положения уголков на изображении объекта можно добиться высокой устойчивости при сопровождении. Эти результаты подтверждаются работой [8], в которой используется сопровождения нескольких таких уголков.

Основным недостатком алгоритмов визуального сопровождения является необходимость качественной начальной инициализации положения объекта. В задаче сопровождения людей в видеопоследовательности для решения этой проблемы можно использовать детекторы людей. Также методы визуального сопровождения не учитывают наличие нескольких объектов сопровождаемого класса в видеопоследовательности. Это может приводит к переключению сопровождения на другой схожий объект при их перекрытии на изображении.

\subsection{Сопровождение-через-обнаружение}

Для сопровождения множества объектов определённого класса в видеопоследовательности наиболее перспективным является подход сопровождение-через-обнаружение. Данные алгоритмы могут быть применены лишь для сопровождения объектов заранее заданных классов, например, людей, лиц, машин и т.д. В отличие от алгоритмов визуального сопровождения, они используют заранее обученный детектор, для обнаружения объектов сопровождаемого класса в видеопоследовательности. После этого происходи поиск обнаружений, относящихся к одному и тому же объекту.

Качество работы алгоритмов сопровождения-через-обнаружение зависит от двух факторов: используемого алгоритма локализации объектов на изображении и метода построения их траекторий. Частичное перекрытие объектов на изображении представляет сложность для их обнаружения детекторами. Поэтому при сопровождении людей в видеопоследовательности детектор людей в некоторых случаях заменяют детекторами частей тела человека \cite{izadinia20122t}. В работах \cite{wu2012coupling,yan2012track} предлагается объединить обнаружение объектов на кадре и их сопровождение в видеопоследовательности в рамках единой задачи оптимизации.

Существует несколько постановок задачи построения траектории движения. Первая постановка подразумевает распределение обнаруженных объектов по множествам (траекториям), и сводится к задаче дискретной оптимизации. Один из способов решение такой задачи --- моделирование траектории движения динамической байесовской сетью и поиск максимума апостериорной вероятности [1, 9, 10, 11]. Свойство марковости таких сетей позволяет определять состояние объекта через его состояние в предыдущий момент времени. В качестве состояния учитывают положение и скорость объекта. Другой способ заключается в сведении задачи распределения обнаружений по траекториям к задаче поиска потока минимальной стоимости \cite{leal2011everybody,butt2013multi}.

Другая постановка определяет сопровождение как построение траекторий, проходящих согласованно с обнаруженными положениями объектов. В работах \cite{andriyenko2012discrete,milan2013detection} было предложено моделировать траекторию движения человека с помощью сплайнов. Авторы предложили разбить задачу на два этапа: ассоциирование обнаружений детектора с объектами и построение траектории их движений.

Основной сложностью подхода сопровождение-через-обнаружение является определение, какие обнаружения детектора относятся к одному объекту. При сопровождении людей зачастую невозможно применить методы реидентификации человека по лицу, так как оно может быть не видно, или его изображение имеет слишком низкое разрешение. Поэтому при сопровождении используется информация о его положении и скорости движения. Визуальное сопровождение применяется в алгоритмах сопровождения-через-обнаружение для оценки скорости движения объекта в окрестности кадра, где он был обнаружен [1, 10]. Этот подход не позволяет верно сопоставить обнаружения детектора, когда объект резко меняет направление движения. В работе \cite{milan2013detection} предложили учитывать кривизну траектории и расстояние до других траекторий в видеопоследовательности для качестве регуляризации. Авторы \cite{gong2011multi} предсказывают направление движение людей в видео, используя семантическую информацию о сцене. В работах \cite{leal2011everybody,choi2012unified} учитывается движение людей группами. Авторы оценивают траекторию всей группы и каждого человека внутри неё.

Основным преимуществом алгоритмов сопровождения-через-обнаружение является возможность обнаружить и исправить ошибки алгоритма обнаружения объектов. Для борьбы с ложными срабатываниями детектора объектов в работе [1] к состоянию траектории добавили индикатор того, что траектория состоит из ложных обнаружений. 

\section{Определение позы человека} \label{chapt-related::human_pose_definithion}

Определение позы человека на изображении или в видеопоследовательности --- следующий этап анализа людей в видео. Эта задача имела несколько схожих постановок. Изначально под позой человека понимали положение частей его тела, таких как голень, предплечье, туловище, голова и др. Решение задачи в такой постановке оказалось сложным поскольку размеры частей тела на изображении могут сильно изменяться в зависимости от позы человека. Поэтому в работе \cite{yang2011articulated} авторы определяют позу как положение суставов тела человека на изображении. И эта постановка чаще всего используется в современных работах.

\subsection{Определение позы человека на изображении}

Задача определения позы человека на изображении имеет важную особенность, отличающую её от задачи обнаружения. Определение позы подразумевает построение структурированного выхода, то есть положение разных суставов на изображении зависит друг от друга и эта зависимость определяется физическими размерами тела человека. Существует два основных подхода к использованию этой информации.

\subsubsection{Модель из набора частей}

Первый подход заключается в разделение задачи определения позы человека на два этапа: локализация отдельных суставов и построение наиболее вероятной конфигурации позы человека. Отличительной особенностью данного метода является то, что он позволяет для любой заданной позы предсказать её правдоподобие на данном изображении. Это свойство я активно использую в своей работе.

Этот подход является прямым расширением методов локализации на случай объектов, состоящих из нескольких частей. Особенностью данного подхода является возможность учитывать изменение взаимного положения частей объекта. Впервые этот подход был создан для обнаружения ``нежестких'' объектов в сцене \cite{felzenszwalb2008discriminatively}, но в дальнейшем его применили для определении позы человека на изображении \cite{yang2011articulated}.

Такая модель объекта была названа модель из набора деформируемых частей (deformable parts model). Объект представляется в виде марковской сети, где вершины соответствуют искомым суставам, а связи задают ограничения на их взаимное расположение. Размер пространства возможных положений каждого сустава очень велик, так как пропорционален количеству пикселей на изображении. Поэтому в работах \cite{yang2011articulated,pirsiavash2012steerable} авторы ограничивались рассмотрением только парных потенциалов, заданных в виде квадратичных функций от положений суставов. Чтобы вывод в графической модели был точным и эффективным, авторы ограничились рассмотрением только моделей в виде дерева.

В общем виде модель из набора частей определяет позу $P$ человека как минимум функции энергии, описываемой двумя типами потенциалов (факторов):
\begin{equation}
	E(P) = \sum_{i\in V}{\phi_i(p_i, s)} + \sum_{\left(i,j\right)\in E}{\psi_{(i,j)}^s(p_i, p_j, s)},
	\label{eq::rel::im_pose}
\end{equation} 
где $\phi_i$ "--- унарный потенциал сустава $p_i$, $\psi_{(i,j)}^s$ задаёт парный потенциал для суставов $p_i$ и $p_j$ на изображении, а $s$ "--- дискретный параметр размера человека. В базовом методе предполагалось, что только унарный потенциал $\phi_i$ зависит от входного изображения. Размер $s$ является скрытым, глобальным параметром, задающим масштаб тела человека на изображении. Благодаря ему удается избежать ситуаций, когда в найденной позы одни части непропорционально больше других.

Одним из недостатков модели из набора деформируемых частей, предложенной в \cite{yang2011articulated} является наличие только парных зависимостей суставов позы. Например,
в описанной модели позы положения коленей не имеют прямой зависимости, и связаны через положение суставов туловища. Это приводит к тому, что алгоритм может расположить суставы обеих ног человека на изображении одной ноги. Поэтому в работе \cite{pishchulin2013poselet} было предложено расширить модель человека набором \textit{позлетов} (в английской версии \textit{poselet}), которые ограничивают взаимное расположение некоторого подмножества суставов тела человека. Несмотря на то, что полученная графическая модель больше не является деревом, алгоритм вывода остался эффективным, поскольку допускает перебор по небольшому множеству состояний позлетов.

Базовая модель предполагает, что все суставы тела человека видны на изображении. Это становится серьезной проблемой в ситуациях частичной видимости тела человека на изображении из-за перекрытий и частичным выходом человека за границу изображения. В работах \cite{ghiasi2014parsing,chen2015parsing} авторы предлагали определять является ли сустав перекрытым изображением другого человека.

В работе \cite{chou2013modeling} авторы указывают на важность моделирования внешности человека для более точной оценки его позы. Они расширили модель позы человека гистограммой цветов его изображения и предложили метод совместного оценки параметров, который повышает точность решения задачи определения позы.

В работах \cite{yang2011articulated,pirsiavash2012steerable,ghiasi2014parsing,pishchulin2013poselet} авторы использовали эвристические признаки для описания изображения, а обучение параметров графической модели происходило с помощью структурного метода опорных векторов \cite{finley2008training}. В работе \cite{girshick2015deformable} авторы показали, что модель из набора частей может быть представлена с помощью сверточной нейронной сети прямого распространения. В последующих работах \cite{chen2014articulated,tompson2014joint,chen2015parsing} авторы использовали признаки обученные с помощью сверточных нейронных сетей для построения унарных потенциалов вершин, соответствующих суставам.

В работе \cite{park2011n} авторы показали, что модель из набора деформируемых частей позволяет определять не только одну позу человека, но и строить множество наиболее правдоподобных поз, отличающихся в положении хотя бы одного сустава. Каждая такая поза является гипотезой положения суставов человека на изображении. Особенностью данного метода является то, что, если количество необходимых гипотез значительно меньше количества возможных положений одного сустава, то вычислительная сложность построения множества таких гипотез не более чем в два раза превосходит сложность построения наилучшей гипотезы позы человека.

\subsubsection{Регрессия положения суставов}

Альтернативным подходом к определению позы человека на изображении является метод регрессии положения суставов из изображения. Алгоритмы этого подхода . В отличие от предыдущего метода он не позволяет оценить качество произвольной позы на изображении.

В работе \cite{toshev2014deeppose} авторы построили отображение входного изображения в координаты каждого сустава. Предложенный ими алгоритм представляет каскад из двух нейронных сетей, которые последовательно уточняют положение каждого сустава на изображении. Авторы показали, что первый регрессор указывает приближенное положение суставов всего тела, в то время как второй, уточняет положение отдельных суставов. В работе \cite{tompson2015efficient} авторы указали, что предсказание тепловой карты положения суставов позволяет добиться лучших результатов в рамках того же подхода.

В работе \cite{bulat2016human} авторы расширили предыдущих подход. Для уточнения локализации каждого сустава они предложили использовать также тепловые карты положения других суставов. Такой подход наиболее близок к модели из набора деформируемых частей, но позволяет при учитывать положение всех суставов на изображении при их уточнении. Наиболее сложной для данного метода является ситуация наличия на одном изображении нескольких людей, изображения которых частично перекрывают друг друга.
 
\subsection{Определение позы человека в видеопоследовательности}

Модель из набора частей допускает прямое расширение на случай последовательности кадров. Для этого вводится модель движения, описывающая изменение позы между кадрами. Наиболее простым её вариантом является задание независимых моделей движения для каждого сустава:
\begin{equation}
	E(\left\{P_t\right\}_{t=1}^T) = \sum_{t=1}^T E(P) + \sum_{i\in V}\sum_{t=1}^{T-1}\psi_i^s(p_i^{t+1}, p_i^t, s^t),
\end{equation}
где $E(P)$ "--- модель позы человека на изображении (\ref{eq::rel::im_pose}).

В работе \cite{park2011n} авторы предложили простую модель изменения позы, предполагающую слабое её изменение между кадрами. В качестве парного потенциала была выбрана квадратичная функция изменения положения суставов между кадрами.

Вывод даже в такой простой модели оказывается сложной задачей, так как графическая модель содержит циклы. Точный вывод оказывается невозможным из-за недопустимой временной сложности алгоритмов. Поэтому авторы \cite{park2011n} использовали построение наилучших гипотез позы человека на изображении, чтобы уменьшить количество допустимых поз и свести задачу определению оптимального состояния в марковской цепи.