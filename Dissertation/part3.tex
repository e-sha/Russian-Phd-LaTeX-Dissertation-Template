%\chapter{Вёрстка таблиц} \label{chapt3}

\chapter{Локализация людей на изображении} \label{chapt3}

В данной главе рассматривается задача локализации объектов на изображении. Поза и калибровка камеры накладывают существенные ограничения на возможные размеры и положения объектов на изображении. Например, в системах видеонаблюдения на проезжей части изображения автомобилей не могут полностью находиться выше уровня горизонта. В этой главе представлен метод расширения алгоритмов локализации объектов на изображении информацией о позе и калибровке камеры для увеличения их точности и производительности. Предложенный метод позволяет учесть эти ограничения, и может быть применен к для расширения детектора любого объекта в сцене.

Формально, предложенный алгоритм определяется следующим образом:
\begin{itemize}
	\item[Вход:]
	\begin{enumerate}
		\item Изображение $I$;
		\item Параметры позы $l_c$ камеры (см. главу \ref{chapt2});
		\item Фокусное расстояние $f$ камеры;
		\item Базовый детектор объектов на изображении $d_b$;
	\end{enumerate}
	\item[Выход:] Множество прямоугольников, ограничивающих изображения объектов интереса.
\end{itemize}

Ключевой идеей предложенного метода является классификация результатов локализации объектов на ``правдоподобные'' и ``невозможные'' с геометрической точки зрения. Он состоит из двух этапов: 1) локализация объектов базовым алгоритмом $d_b$; 2) классификация результатов локализации. Предложенный метод может быть интегрирован с любым методом локализации объектов на изображении. При интеграции с алгоритмами, использующие скользящее окно для локализации, предложенный метод позволяет также увеличить производительность базового алгоритма. В этой работе я показал способ его применения для увеличения производительности и точности базового алгоритма локализации голов людей на изображении \cite{prisacariu2009fasthog}.

Для применения предложенного метода локализации объектов интереса необходимо решить 3 задачи:
\begin{enumerate}
	\item Построить синтетическую выборку наблюдаемых данных;
	\item Построить признаки, инвариантные для синтетических и реальных данных;
	\item Обучение классификатора результатов работы алгоритма локализации объектов.
\end{enumerate}
В дальнейших разделах будет подробно описано решение всех этих задач.

\section{Математическая модель наблюдаемых данных}

Я использую модель наблюдаемых данных, описанную в \ref{chap-cam_pose::sec-model}.

\section{Предложенный метод}

Я предложил метод расширения методов локализации объектов на изображении информацией о позе и параметрах камеры в сцене. Предложенный метод позволяет учитывать физические ограничения на положение объектов в сцене при их локализации на изображении. Для решения этой задачи я предложил метод классификации обнаружений базового алгоритма $d_b$ на ``правдоподобные'' и ``невозможные''.

\subsection{Построение обучающей выборки}

Обучение классификатора на реальных данных оказывается затруднительным из-за малого количества размеченных данных. Поэтому была использована синтетическая выборка, описанная в разделе \ref{chapt2::sect_dataset}. В качестве признакового описания результатов обнаружения использовались параметры 1) обнаруженного региона и 2) используемой камеры. Таким образом, входом алгоритма классификации является вектор, состоящий из:
\begin{itemize}
	\item результат обнаружения $o = (x_o, y_o, s_o)$ объекта базовым алгоритмом $d_b$;
	\item поза $l_c = (h, t, r)$ камеры;
	\item фокусное расстояние $f$ камеры.
\end{itemize}

Формально задача классификации срабатываний детектора по построенной выборке относится к классу задач поиска аномалий. Отличительной особенностью таких задач является отсутствие примеров отрицательного класса (ошибки детектора) в обучающей выборке. В своей работе я предложил способ моделирования объектов такого класса. Для их построения я объединил две стратегии: 1) использование обнаружений, характерных для других последовательностей обучающей выборки; 2) использование регионов изображения с произвольным положением и размером. Первая стратегия позволяет обучать классификатор, дискриминативный к позе и калибровке камеры. Вторая стратегия позволяет классификатору отличать верные обнаружения от ложных срабатываний базового детектора $d_p$. При построении отрицательных примеров обучающей выборки эти стратегии использовались в отношении 1:9.

\subsection{Построение классификатора}

Для построения классификатора обнаружений детектора мы использовали нейронную сеть, представленную на рисунке \ref{}. Сеть состоит из последовательности полносвязных слоёв и нелинейной функциии ReLu.

\section{Обучение и экспериментальная оценка}

\subsection{Обучение}

Я обучил предложенную сеть на синтетической выборке, состоящей из 24143 сцен, с помощью библиотеки caffe \cite{CITATION jia2014caffe \l 1033}. Скорость обучения понижалась каждые 1500 итераций со степенной скоростью $\gamma = 0.95$.

\subsection{Экспериментальная оценка на синтетической выборке}

Я оценили качество предложенного алгоритма на синтетических и реальных данных, а также интегрировали его с используемым детектором.

Мы провели тестирование на синтетической выборке. Наша тестовая выборка состоит из 6036 различных сцен, не использованных при обучении. На рисунке \ref{}~(а) представлено качество классификации обнаружений на синтетической тестовой выборке. 

\subsection{Экспериментальная оценка на реальных данных}

Для проведения тестирования необходимо знать положение камеры для каждого кадра выборки. Это затрудняет использование стандартных баз размеченных изображений.

Я использовал выборку TownCentre \cite{benfold2011stable}. Были использованы параметры позы камеры, предсказанные методом из главы \ref{chapt2}. При классификации результатов локализации объектов базовым алгоритмом $d_b$ я использовал параметр 0.25. Обнаружение считалось правильным, если его пересечение с регионом головы человека в разметке занимало не менее 25\% их объединения. Сравнение качества исходного и полученного детектора (см. рис.~\ref{}(б)) выявило, что предложенный алгоритм фильтрации позволяет увеличить точность без существенного уменьшения полноты базового алгоритма локализации.

\subsection{Интеграция с алгоритмом детектирования}

Я показал, как предложенный метод классификации можно использовать для увеличения производительности базового детектора $d_b$. Построенный классификатор задает статические ограничения на допустимые положения объектов на изображении. Эта идея продемонстрирована для позы камеры соответствующей выборке TownCentre на рисунке~\ref{} (первая строка). Таким образом, для каждого размера объекта на изображении, можно указать, регион, где он может быть обнаружен.

Эта информация может быть использована для увеличения производительности базового алгоритма локализации. Если базовый алгоритм использует пирамиду изображений, то для каждого её уровня обрабатывать необходимо лишь небольшой регион, предсказанный классификатором. Для алгоритмов, производящих регрессию заранее заданных прямоугольников, для каждого региона изображения классификатор предсказывает, какие прямоугольники не могут соответствовать правдоподобным положениям объектов интереса.

В этой работе я применил этот метод для увеличения производительности базового детектора \cite{prisacariu2009fasthog}. При тестировании на выборке TownCentre классификатор указывает, что необходимо обработать лишь 21.44\% регионов на всех уровнях пирамиды. В предложенной реализации алгоритм обрабатывает прямоугольные регионы изображения на каждом уровне пирамиды (см. рис.~\ref{} вторая строка). Это привело к обработке 24.03\% всех регионов, но упростило реализацию. Такой подход позволил увеличит производительность алгоритма локализации изображений голов людей с 20.03 до 34.36 кадров в секунду на выборке TownCentre.

\iffalse
\chapter{Определение позы человека в видео}
\fi

\section{Таблица обыкновенная} \label{sect3_1}

Так размещается таблица:

\begin{table} [htbp]
  \centering
  \captionsetup{width=15cm}
  \caption{Название таблицы}\label{Ts0Sib}%
  \begin{tabular}{| p{3cm} || p{3cm} | p{3cm} | p{4cm}l |}
  \hline
  \hline
  Месяц   & \centering $T_{min}$, К & \centering $T_{max}$, К &\centering  $(T_{max} - T_{min})$, К & \\
  \hline
  Декабрь &\centering  253.575   &\centering  257.778    &\centering      4.203  &   \\
  Январь  &\centering  262.431   &\centering  263.214    &\centering      0.783  &   \\
  Февраль &\centering  261.184   &\centering  260.381    &\centering     $-$0.803  &   \\
  \hline
  \hline
  \end{tabular}
\end{table}

\begin{table} [htbp]% Пример записи таблицы с номером, но без отображаемого наименования
	\centering
	\parbox{9cm}{% чтобы лучше смотрелось, подбирается самостоятельно
        \captionsetup{format=tablenocaption}% должен стоять до самого caption
        \caption{}%
        \label{tbl:test1}%
        \begin{SingleSpace}
    	\begin{tabular}{ | c | c | c | c |}
    	\hline
    	Оконная функция	& ${2N}$ & ${4N}$	& ${8N}$	\\ \hline
    	Прямоугольное 	& 8.72 	 & 8.77		& 8.77		\\ \hline
    	Ханна		& 7.96 	 & 7.93		& 7.93		\\ \hline
    	Хэмминга	& 8.72 	 & 8.77		& 8.77		\\ \hline
    	Блэкмана	& 8.72 	 & 8.77		& 8.77		\\ \hline
    	\end{tabular}%
    	\end{SingleSpace}
	}
\end{table}

Таблица \ref{tbl:test2} "--- пример таблицы, оформленной в~классическом книжном варианте или~очень близко к~нему. \mbox{ГОСТу} по~сути не~противоречит. Можно ещё~улучшить представление, с~помощью пакета \verb|siunitx| или~подобного.

\begin{table} [htbp]%
    \centering
	\caption{Наименование таблицы, очень длинное наименование таблицы, чтобы посмотреть как оно будет располагаться на~нескольких строках и~переноситься}%
	\label{tbl:test2}% label всегда желательно идти после caption
    \renewcommand{\arraystretch}{1.5}%% Увеличение расстояния между рядами, для улучшения восприятия.
    \begin{SingleSpace}
	\begin{tabular}{@{}@{\extracolsep{20pt}}llll@{}} %Вертикальные полосы не используются принципиально, как и лишние горизонтальные (допускается по ГОСТ 2.105 пункт 4.4.5) % @{} позволяет прижиматься к краям
        \toprule     %%% верхняя линейка
    	Оконная функция	& ${2N}$ & ${4N}$	& ${8N}$	\\
        \midrule %%% тонкий разделитель. Отделяет названия столбцов. Обязателен по ГОСТ 2.105 пункт 4.4.5 
    	Прямоугольное 	& 8.72 	 & 8.77		& 8.77		\\
    	Ханна		& 7.96 	 & 7.93		& 7.93		\\
    	Хэмминга	& 8.72 	 & 8.77		& 8.77		\\
    	Блэкмана	& 8.72 	 & 8.77		& 8.77		\\
        \bottomrule %%% нижняя линейка
	\end{tabular}%
   	\end{SingleSpace}
\end{table}

\section{Таблица с многострочными ячейками и примечанием}

Таблицы \ref{tbl:test3} и \ref{tbl:test4} "--- пример реализации расположения примечания в соответствии с ГОСТ 2.105. Каждый вариант со своими достоинствами и недостатками. Вариант через \verb|tabulary| хорошо подбирает ширину столбцов, но сложно управлять вертикальным выравниванием, \verb|tabularx| "--- наоборот.
\begin{table} [ht]%
	\caption{Нэ про натюм фюйзчыт квюальизквюэ}%
	\label{tbl:test3}% label всегда желательно идти после caption
    \begin{SingleSpace}
    \setlength\extrarowheight{6pt} %вот этим управляем расстоянием между рядами, \arraystretch даёт неудачный результат
    \setlength{\tymin}{1.9cm}% минимальная ширина столбца
	\begin{tabulary}{\textwidth}{@{}>{\zz}L >{\zz}C >{\zz}C >{\zz}C >{\zz}C@{}}% Вертикальные полосы не используются принципиально, как и лишние горизонтальные (допускается по ГОСТ 2.105 пункт 4.4.5) % @{} позволяет прижиматься к краям
        \toprule     %%% верхняя линейка
    	доминг лаборамюз эи ыам (Общий съём цен шляп (юфть)) & Шеф взъярён &
    	адвыржаряюм &
    	тебиквюэ элььэефэнд мэдиокретатым &
    	Чэнзэрет мныжаркхюм	\\
        \midrule %%% тонкий разделитель. Отделяет названия столбцов. Обязателен по ГОСТ 2.105 пункт 4.4.5 
         Эй, жлоб! Где туз? Прячь юных съёмщиц в~шкаф Плюш изъят. Бьём чуждый цен хвощ! &
        ${\approx}$ &
        ${\approx}$ &
        ${\approx}$ &
        $ + $ \\
        Эх, чужак! Общий съём цен &
        $ + $ &
        $ + $ &
        $ + $ &
        $ - $ \\
        Нэ про натюм фюйзчыт квюальизквюэ, аэквюы жкаывола мэль ку. Ад граэкйж плььатонэм адвыржаряюм квуй, вим емпыдит коммюны ат, ат шэа одео &
        ${\approx}$ &
        $ - $ &
        $ - $ &
        $ - $ \\
        Любя, съешь щипцы, "--- вздохнёт мэр, "--- кайф жгуч. &
        $ - $ &
        $ + $ &
        $ + $ &
        ${\approx}$ \\
        Нэ про натюм фюйзчыт квюальизквюэ, аэквюы жкаывола мэль ку. Ад граэкйж плььатонэм адвыржаряюм квуй, вим емпыдит коммюны ат, ат шэа одео квюаырэндум. Вёртюты ажжынтиор эффикеэнди эож нэ. &
        $ + $ &
        $ - $ &
        ${\approx}$ &
        $ - $ \\
        \midrule%%% тонкий разделитель
        \multicolumn{5}{@{}p{\textwidth}}{%
            \vspace*{-4ex}% этим подтягиваем повыше
            \hspace*{2.5em}% абзацный отступ - требование ГОСТ 2.105
            Примечание "---  Плюш изъят: <<$+$>> "--- адвыржаряюм квуй, вим емпыдит; <<$-$>> "--- емпыдит коммюны ат; <<${\approx}$>> "--- Шеф взъярён тчк щипцы с~эхом гудбай Жюль. Эй, жлоб! Где туз? Прячь юных съёмщиц в~шкаф. Экс-граф?
        }
        \\
        \bottomrule %%% нижняя линейка
	\end{tabulary}%
    \end{SingleSpace}
\end{table}

Из-за того, что таблица \ref{tbl:test3} не помещается на той же странице (при компилировании pdflatex), всё её содержимое переносится на следующую, ближайшую, а этот текст идёт перед ней.
\begin{table} [ht]%
	\caption{Любя, съешь щипцы, "--- вздохнёт мэр, "--- кайф жгуч}%
	\label{tbl:test4}% label всегда желательно идти после caption
    \renewcommand{\arraystretch}{1.6}%% Увеличение расстояния между рядами, для улучшения восприятия.
	\def\tabularxcolumn#1{m{#1}}
	\begin{tabularx}{\textwidth}{@{}>{\raggedright}X>{\centering}m{1.9cm} >{\centering}m{1.9cm} >{\centering}m{1.9cm} >{\centering\arraybackslash}m{1.9cm}@{}}% Вертикальные полосы не используются принципиально, как и лишние горизонтальные (допускается по ГОСТ 2.105 пункт 4.4.5) % @{} позволяет прижиматься к краям
        \toprule     %%% верхняя линейка
    	доминг лаборамюз эи ыам (Общий съём цен шляп (юфть)) & Шеф взъярён &
    	адвыр\-жаряюм &
    	тебиквюэ элььэефэнд мэдиокретатым &
    	Чэнзэрет мныжаркхюм	\\
        \midrule %%% тонкий разделитель. Отделяет названия столбцов. Обязателен по ГОСТ 2.105 пункт 4.4.5 
         Эй, жлоб! Где туз? Прячь юных съёмщиц в~шкаф Плюш изъят. Бьём чуждый цен хвощ! &
        ${\approx}$ &
        ${\approx}$ &
        ${\approx}$ &
        $ + $ \\
        Эх, чужак! Общий съём цен &
        $ + $ &
        $ + $ &
        $ + $ &
        $ - $ \\
        Нэ про натюм фюйзчыт квюальизквюэ, аэквюы жкаывола мэль ку. Ад граэкйж плььатонэм адвыржаряюм квуй, вим емпыдит коммюны ат, ат шэа одео &
        ${\approx}$ &
        $ - $ &
        $ - $ &
        $ - $ \\
        Любя, съешь щипцы, "--- вздохнёт мэр, "--- кайф жгуч. &
        $ - $ &
        $ + $ &
        $ + $ &
        ${\approx}$ \\
        Нэ про натюм фюйзчыт квюальизквюэ, аэквюы жкаывола мэль ку. Ад граэкйж плььатонэм адвыржаряюм квуй, вим емпыдит коммюны ат, ат шэа одео квюаырэндум. Вёртюты ажжынтиор эффикеэнди эож нэ. &
        $ + $ &
        $ - $ &
        ${\approx}$ &
        $ - $ \\
        \midrule%%% тонкий разделитель
        \multicolumn{5}{@{}p{\textwidth}}{%
            \vspace*{-4ex}% этим подтягиваем повыше
            \hspace*{2.5em}% абзацный отступ - требование ГОСТ 2.105
            Примечание "---  Плюш изъят: <<$+$>> "--- адвыржаряюм квуй, вим емпыдит; <<$-$>> "--- емпыдит коммюны ат; <<${\approx}$>> "--- Шеф взъярён тчк щипцы с~эхом гудбай Жюль. Эй, жлоб! Где туз? Прячь юных съёмщиц в~шкаф. Экс-граф?
        }
        \\
        \bottomrule %%% нижняя линейка
	\end{tabularx}%
\end{table}

%\newpage
%============================================================================================================================

\section{Параграф - два} \label{sect3_2}

Некоторый текст.

%\newpage
%============================================================================================================================

\section{Параграф с подпараграфами} \label{sect3_3}

\subsection{Подпараграф - один} \label{subsect3_3_1}

Некоторый текст.

\subsection{Подпараграф - два} \label{subsect3_3_2}

Некоторый текст.

\clearpage