\chapter{Определение позы человека в видеопоследовательности} \label{chapt6}

В этой главе я рассматриваю задачу определения позы человека в видеопоследовательности. Как описано в обзоре \ref{chapt-related::human_pose_definithion}, в настоящий момент научное сообщество определяет позу человека на изображении как положение его $K$ суставов.

В своей работе я рассматриваю алгоритм определения позы человека в качестве следующего этапа обработки видеоданных после сопровождения. Поэтому моя постановка задачи определения позы в видеопоследовательности имеет следующий вид:
\begin{itemize}
	\item[Вход:] 
	\begin{enumerate}
		\item видеопоследовательность $I=\left\{I_t\right\}_{i=1}^N$;
		\item положение человека на каждом кадре $B=\left\{B_i\right\}_{i=1}^N$
	\end{enumerate}
	\item[Выход:] положение всех суставов тела человека на всех изображениях $P=\left\{P_i^j\right\}_{i=1,j=1}^{N,K}$.
\end{itemize}

\section{Математическая модель наблюдаемых данных}

Предложенная модель наблюдаемых данных является прямым расширением модели позы человека на изображении на случай видеопоследовательности. Поэтому она состоит из двух частей: 1) базовая модели позы человека на изображении и 2) модель движения её суставов.

\subsection{Модель позы человека на изображении}

Согласно обзору существующих методов в научных работах представлены две основные модели позы человека: модель из набора деформируемых частей и регрессионная модель позы. Несмотря на то, что вторая модель на момент написания данной диссертации позволяет добиться лучших результатов, её обобщение на случай видеопоследовательности затруднено. Действительно, в настоящий момент регрессионная модель не позволяет интегрировать априорные предположения о позе человека на кадре, а следовательно не позволяет использовать результаты полученные на других кадрах. Поэтому в качестве базовой модели позы человека на изображении была выбрана модель из набора деформируемых частей. Применяемая в ней графическая модель, задающая связь между суставами человека, определяет ненормированное вероятностное распределение, а следовательно позволяет интегрировать её как часть большей графической модели.

Для дальшего рассмотрения модели позы человека важно отметить, то модель из набора частей строит вероятностное распределение на множестве допустимых положений суставов $\left\{P^j\right\}$ тела человека и параметра его размера $S$. Размер $S$ является скрытым параметром, глобальным параметром, задающим масштаб тела человека на изображении. Благодаря ему удается избежать ситуаций, когда в найденной позы одни части непропорционально больше других.

\subsection{Модель движения}

Я расширил модель позы человека информацией о движении его суставов. Она состоит из моделей движения отдельных суставов и учитывает их независимо. Так как модели движения разных суставов схожи, то достаточно рассмотреть её лишь для одного из них. Для упрощения обозначений в данном подразделе я опускаю индекс рассматриваемого сустава. Например, через $P_i$ я обозначаю положение рассматриваемого сустава на {\textit i-ом} кадре. В работе \cite{park2011n} предлагалась модель движения, предполагающее слабое изменение позы человека между кадрами:
\begin{equation*}
	\psi(P_i, P_{i-1}, S_{i-1}) = -\frac{1} {2 S_{i-1}^2}(P_i - P_{i-1})^T \Sigma_p^{-1} (P_i - P_{i-1})
\end{equation*}
Таким образом, оптимальное значение такой модели движения достигается при постоянстве позы человека в видео. Изменение позы при движении оказывается ,,допустимым шумом`` в такой модели. В своей работе я расширил эту модель движения. Я использовал линейную динамическую систему для предсказания положения суставов на следующем кадре:
\begin{equation}
	\begin{aligned}
		\psi(H_i, H_{i-1}, S_{i-1}) &=
			-\frac{1}{2 S_{i-1}^2} (H_i - A H_{i-1})^T \Sigma_p^{-1} (H_i - A H_{i-1}) \\
	\end{aligned}
\end{equation}
Неизвестное состояние $H_i$ включает в себя положение и характеристики движения сустава. В этой работе я рассматривал линейную модель движения суставов:
\begin{equation}
	\begin{aligned}
		H_i &= \left[P_i, V_i\right] \\
		A &=
			\begin{bmatrix}
			1 & 0 & 1 & 0 \\
			0 & 1 & 0 & 1 \\
			0 & 0 & 1 & 0 \\
			0 & 0 & 0 & 1 \\
			\end{bmatrix} \\
	\end{aligned}
\end{equation}

Матрица $\Sigma_p$ описывает допустимое отклонение движения суставов от линейной модели:
\begin{equation}
	\begin{aligned}
		\Sigma_p &= \left[
			\begin{array}{c|c}
			\Sigma_p^p & \Theta \\ \hline
			\Theta     & \Sigma_p^v
			\end{array}
			\right] \\
		\Sigma_p^p &= \alpha_p^{-1} I_{2\times2} \\
		\Sigma_p^v &= \alpha_v^{-1} I_{2\times2}
	\end{aligned}
\end{equation}
Таким образом, в предложенной модели позы человека появляются дополнительные скрытые параметры скорости движения суставов.

Аналогичную модель изменения можно предложить для параметра размера тела человека $S_i$. Однако, в данной работе я ограничился рассмотрением более простой модели изменения этого параметра:
\begin{equation}
	\psi^s(S_{i-1}, S_i) = -\frac{1}{2} \left(\frac{S_i - S_{i-1}}{S_{i-1}\sigma_s}\right)^2
\end{equation}

\subsection{Сравнение с аналогами}

Показать, как можно получить независимое определение позы на каждом кадре.

Показать, как можно получить модель \cite{park2011n}.

\section{Метод оптимизации}

\subsection{Анализ модели} P.S. показать, что глобальная оптимизация невозможна

Каждой функции энергии, описывающей модель позы человека, соответствует марковская сеть. От её свойств зависит сложность алгоритмов поиска оптимального значения модели. В общем случае сложность оптимизации не меньше количества допустимых состояний минимальной группы вершин, разделяющих графическую модель на две части. Если графическая модель является деревом, то сложность алгоритма квадратично зависит от количества допустимых состояний для каждой вершины. Примером такой графической модели является модель позы человека на изображении при условии известного параметра масштаба. Специальный вид парных потенциалов, позволил сократить сложность вывода в графической модели до линейной зависимости от количества допустимых положений суставов на изображении.

К сожалению, при расширении этой модели, в марковской сети появляются циклы, а следовательно сложность поиска оптимального решения существенно возрастает. На рисунке \ref{} представлена графическая модель, соответствующая модели \cite{park2011n}. Если размер последовательности превосходит количество суставов в позе человека, то поза вершины позы человека на кадре образуют минимальное количество вершин, разделяющих графическую модель на две части. Можно заметить, что на высоком уровне эта модель представляет марковскую цепь, но каждая её вершина описывает позу человека на одном кадре. Если на каждом кадре имеется $M$ возможных положений сустава, и поза состоит из $K$ суставов, то сложность алгоритма распространения доверия равна $\mathcal{O}(M^{K}T)$. Здесь существенно использован факт, что парный потенциал $\psi$ является квадратичной формой, и для вычисления сообщений может быть использован метод дистантного преобразования. Таким образом, сложность поиска оптимального множества поз линейно зависит от количества возможных поз человека на изображении. Так как значение параметра $M$ может превосходить $10^4$, а количество суставов исчисляться десятками, то алгоритм поиска точного решения оказывается не применим на практике. Уменьшив количество допустимых поз на кадре изображения, авторы \cite{park2011n} смогли построить приближенное решение задачи.

Предложенная в данной работе модель является расширением \cite{park2011n} и содержит её в качестве частного случая. Также скрытые параметры позы дополнительно включают скорость суставов, а значит содержат больше состояний. Также в своей модели я считаю скорость движения суставов непрерывным параметром, то есть предложенная модель является дискретно-непрерывной.

\subsection{Предложенный метод}

Поиск оптимального решения рассматриваемой функции энергии имеет временную сложность, не допускающую использование его на практике. Поэтому я предложил итеративный алгоритм поиска локального оптимума. Он сводится к последовательному решению двух задач: 1) определении множества наилучших гипотез позы человека на изображении и 2) оценки скорости движения людей. Предложенный алгоритм основан на последовательной оптимизации групп неизвестных параметров при фиксации остальных.

Допустим, что поза и размер человека зафиксированы на всех кадрах кроме кадра $I_i$.

Предложенный алгоритм базируется на том, что при известных значениях части параметров
\begin{itemize}
	\item если известно оптимальное значение позы и размера человека на всех кадрах, то существует эффективный алгоритм поиска оптимального значения остальных параметров;
	\item если известно оптимальное значение позы и размера человека на всех кадрах, кроме одного, а также известно оптимальное значение скорости его суставов, то существует алгоритм поиска оптимального значения параметров на оставшемся кадре.
\end{itemize}

\subsection{Доказательство сходимости}
\subsection{Доказательство корректности}
\subsection{Оценка сложности}
\section{Экспериментальная оценка}
\subsection{Описание тестовых данных}
\subsection{Анализ результатов}
