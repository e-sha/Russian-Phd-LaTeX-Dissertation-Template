\chapter{Определение позы человека в видеопоследовательности} \label{chapt6}

В этой главе я рассматриваю задачу определения позы человека в видеопоследовательности. Как описано в обзоре \ref{chapt-related::human_pose_definithion}, в настоящий момент научное сообщество определяет позу человека на изображении как положение его $K$ суставов. Таким образом, позой человека в момент времени $t$ является последовательность точек $P^t \in \left\{ \left\{p_i^t\right\}_{i=1}^K | p_i^t \in \mathbb{R}^2\right\}$ на изображении.

В своей работе я рассматриваю алгоритм определения позы человека в качестве следующего этапа обработки видеоданных после сопровождения. Поэтому моя постановка задачи определения позы в видеопоследовательности имеет следующий вид:
\begin{itemize}
	\item[Вход:] видеопоследовательность $I=\left\{I_t\right\}_{i=1}^N$;
	\item[Выход:] поза человека на каждом кадре $P=\left\{P^t\right\}_{t=1}^{N}$.
\end{itemize}

\section{Математическая модель наблюдаемых данных}

Я рассматриваю определение позы человека в видео как задачу минимизации функции энергии $E(P, \Theta|I)$, где $\Theta$ "--- скрытые параметры модели. Параметр $\Theta$ может включать как скрытые параметры позы человека на одно кадре (например, параметр размера), так и глобальные параметры модели человека (цветовая модель). Можно считать, что функция энергии $E(P, \Theta|I)$ задаёт ненормированную функцию правдоподобия позы в видеопоследовательности в виде $\tilde{p}(P, \Theta|I) = \exp\left(-E(P, \Theta|I)\right)$. В дальнейшем для упрощения выкладок я буду неявно предполагать зависимость функции энергии от исходной видеопоследовательности, т.~е. $E(P, \Theta) = E(P, \Theta|I)$.

Используемая модель наблюдаемых данных является обобщением модели позы человека на изображении на случай видеопоследовательности. Для этого базовая модель расширяется предположением о зависимости позы человека на разных кадрах. Стандартный подход к расширению модели позы человека на случай видеопоследовательности соответствует следующей функции энергии:
\begin{equation}
	\begin{aligned}
		E(P, \Theta) &= \sum_{t=1}^T E_I(P^t, \Theta) + \sum_{t=1}^{T-1}E_T(P^{t+1}, P^{t}, \Theta),
	\end{aligned}
\end{equation}
где $E_I(P^t)$ "--- модель позы человека на кадре \eqref{eq::frame}, а $E_T(P^{t+1}, P^{t})$ "--- модель изменения позы между кадрами. Такую модель можно рассматривать как марковскую цепь первого порядка, где состояние в каждый момент времени является многомерной величиной и описывает позу человека.

Она состоит из двух частей: 1) базовая модели позы человека на изображении $E_I(P^t, \Theta)$ и 2) модель движения её суставов $E_T(P^{t+1}, P^{t}, \Theta)$.

\subsection{Модель позы человека на изображении}

Согласно обзору существующих методов в научных работах представлены две основные модели позы человека: модель из набора деформируемых частей и регрессионная модель позы.

Несмотря на то, что регрессионная модель на момент написания данной диссертации позволяет добиться лучших результатов определения позы на изображении, её обобщение на случай видеопоследовательности затруднено. Построенное отображение входного изображения $I_t$ на позу человека $P^t$ на нем не позволяет использовать априорные сведения, полученные на соседних кадрах.

Поэтому в качестве базовой модели позы человека на изображении была выбрана модель из набора деформируемых частей. Соответствующая ей марковская сеть, определяет ненормированную функцию правдоподобия $\tilde{p}(P^t, \Theta^t) = \exp(-E_I(P^t, \Theta))$. Это свойство позволяет интегрировать её как часть большей графической модели, используя информацию с предыдущих кадров для построения априорных ограничений.

Модель из набора частей описывается с помощью функции энергии $E_I(P^t, \Theta^t)$, минимум которой определяется в качестве позы человека на изображении $I_t$:
\begin{equation}
	E_I(P^t, \Theta) = \sum_{i=1}^K{\phi_i(p_i^t, s^t)} + \sum_{\left(i,j\right)\in E}{\psi_{(i,j)}^s(p_i^t, p_j^t, s^t)},
	\label{eq::frame}
\end{equation}

Унарный потенциал $\phi_i(p_i^t, s^t)$ можно рассматривать, как отклик алгоритма обнаружения сустава человека на заданном масштабе изображения. Парный потенциал $\psi_{(i,j)}^s(p_i^t, p_j^t, s^t)$ задаётся в виде квадратичной формы, зависящей от смещения между суставами. Функция энергии зависит от параметра размера человека $s^t$ на текущем изображении, и не зависит от остальных скрытых параметров модели.

На практике параметр положения $p^t$ суставов является дискретной величиной, определённой на изображении с некоторым шагом. Параметр размера $s^t$ также является дискретным и соответствует разным масштабам при обнаружении суставов.

\subsection{Модель движения}

Наиболее простым способом задания модели изменения позы является предположение о независимости движения суставов:
\begin{equation}
	E_T(P^{t+1}, P^{t}, \Theta) = \sum_{i=1}^K\psi_i^t(p_i^{t+1}, p_i^t, \Theta)
\end{equation}

Так как модели движения разных суставов схожи, то достаточно рассмотреть её лишь для одного из них. Для упрощения обозначений в данном подразделе я опускаю индекс рассматриваемого сустава. Например, $p^t$ используется для обозначения состояния рассматриваемого сустава на кадре $I_t$.

Такое расширение модели позы человека на изображении на случай видеопоследовательности использовался также в предыдущих работах. Например, в работе \cite{park2011n} предлагалась модель движения, предполагающее слабое изменение позы человека между кадрами:
\begin{equation*}
	\psi^t(p^{t+1}, p^t, \Theta) = \frac{1} {2 {s^t}^2}(p^{t+1} - p^t)^{T-1} \left(\Sigma_p^p\right)^{-1} (p^{t+1} - p^t)
\end{equation*}
Таким образом, оптимальное значение такой модели движения достигается при постоянстве позы человека в видео. Изменение позы при движении оказывается <<допустимым шумом>>.

В этой работе я расширил эту модель движения. Я использовал линейную динамическую систему для описания движения суставов тела человека. Для этого скрытое состояние $\Theta$ модели было расширено характеристикой движения каждого сустава. В работе я рассматриваю линейную модель движения суставов, т.~e. состояние каждого сустава описывается его положением $p^t$ на кадре и мгновенной скоростью движения $v^t \in \mathbb{R}^2$. По аналогии с позой человека, я обозначаю скорость всех суставов в видеопоследовательности через $V$. Если обозначить через $h^t = [p^t, v^t]$ "--- состояние рассматриваемого сустава позы человека на кадре $t$, то предложенная модель движения принимает вид:
\begin{equation}
	\begin{aligned}
		\psi^t(p^{t+1}, p^{t}, \Theta) &=
			\frac{1}{2 {s^t}^2} (h^{t+1} - A h^t)^T \Sigma_p^{-1} (h^{t+1} - A h^t) \\
		A &=
			\begin{bmatrix}
			1 & 0 & 1 & 0 \\
			0 & 1 & 0 & 1 \\
			0 & 0 & 1 & 0 \\
			0 & 0 & 0 & 1 \\
			\end{bmatrix} \\
	\label{eq::temp}
	\end{aligned}
\end{equation}

Допустимое отклонение от линейной модели движения задается симметричной положительно определенной матрицей $\Sigma_p \in \mathbb{S_+}$. Для уменьшения количества параметров я рассматривал только диагональные матрицы $\Sigma_p$ следующего вида:
\begin{equation}
	\begin{aligned}
		\Sigma_p &= \left[
			\begin{array}{c|c}
			\Sigma_p^p & \Theta \\ \hline
			\Theta     & \Sigma_p^v
			\end{array}
			\right] \\
		\Sigma_p^p &= \alpha_p^{-1} I_{2\times2} \\
		\Sigma_p^v &= \alpha_v^{-1} I_{2\times2} \\
		\alpha_p &> 0, \alpha_v > 0,
		\label{eq::sigma}
	\end{aligned}
\end{equation}
Матрица $\Sigma_p^p$ описывает допустимое отклонение положения сустава $p^{t+1}$ от его линейного предсказания $p^t + v^t$, a $\Sigma_p^v$ "--- допустимое изменение скорости сустава между кадрами.

Без дополнительной регуляризации модель движения \eqref{eq::temp} допускает неправдоподобно большое значение скорости движения сустава, так как ограничивает только её изменение. Для решения этой проблемы был добавлен фактор, задающий априорное предпочтение на скорость движения суставов на первом кадре:
\begin{equation}
	\begin{aligned}
		\psi^0(v^1) &= \frac{1}{2 {s^1}^2}{v^1}^T \left({\Sigma_p^{v^1}}\right)^{-1} v^1 \\
		\Sigma_p^{v^1} &= \alpha_{v^1}^{-1} I_{2\times2}
	\end{aligned}
\end{equation}

Также моя модель ограничивает неправдоподобное изменение размера человека между кадрами:
\begin{equation}
	\eta^t(s^{t+1}, s^t) = \frac{1}{2} \left(\frac{s^{t+1} - s^t}{s^t\sigma_s}\right)^2
\end{equation}

Таким образом, предложенная модель движения имеет следующий вид:
\begin{equation}
	\sum_{t=1}^{T-1}{\Psi(P^{t+1}, P^t)} = 
		\sum_{i=1}^K\left(\psi^0_i(v^1_i) + \sum_{t=1}^{T-1}\psi_i^t(h_i^{t+1}, h_i^{t}, \Theta) \right) + \sum_{t=1}^{T-1} \eta^t(s^{t+1}, s^{t})
	\label{eq::motion_model}
\end{equation}

\subsection{Частные случаи}

Предложенная модель имеет два интересных частных случая, рассматриваемых в предыдущих работах.

Рассмотрим случай, когда $\alpha_v \rightarrow +\infty, \alpha_{v^1} \rightarrow +\infty$ и $\sigma_s \rightarrow +\infty$. Этот случай описывает значительное увеличение энергии в случаях, когда значение скорости какого-либо сустава отлично от $0$:
\begin{equation}
	\begin{aligned}
		\lim_{\alpha_{v^1} \rightarrow +\infty}{\argmin_{v^1} \psi^0(v^1)} &= 0 \\
		\lim_{\alpha_{v} \rightarrow +\infty}{\argmin_{v^t} \psi^t(h_i^{t+1}, h_i^{t}, \Theta)} &= 0 \\
		\lim_{\sigma_s \rightarrow +\infty}{\eta^t(s^{t+1},s^t)} &= 0
	\end{aligned}
\end{equation}
То есть оптимальным является решение, где все параметры скорости равны 0. При этом условии модель движения суставов имеет вид:
\begin{equation}
	\begin{aligned}
		\psi^t(h_i^{t+1}, h_i^{t}, \Theta) |_{v^t = v^{t+1} = 0} &= \frac{1} {2 {s^t}^2}(p^{t+1} - p^t)^T \left(\Sigma_p^p\right)^{-1} (p^{t+1} - p^t) \\
		\psi^0(v^1)|_{v^1=0} &= 0
	\end{aligned}
\end{equation}
То есть предложенная модель становится эквивалентной модели движения, описанной в работе \cite{park2011n}.

Рассмотрим другой частный случай. Если ослабить ограничения на небольшое изменение скорости суставов между кадрами, то модель \eqref{eq::motion_model} описывает независимое определение позы человека на каждом кадре. Действительно
\begin{equation}
	\begin{aligned}
		\lim_{\alpha_{v} \rightarrow 0+0}{\psi^t(h_i^{t+1}, h_i^{t}, \Theta)} &= 0 \\
		\lim_{\alpha_{v^1} \rightarrow 0+0}{\psi^0(v^1)} &= 0 \\
		\lim_{\sigma_s \rightarrow +\infty}{\eta^t(s^{t+1},s^t)} &= 0
	\end{aligned}
\end{equation}
То есть графическая модель распадается на независимые связные компоненты, соответствующие позе человека на каждом кадре.

\section{Метод оптимизации}

\subsection{Анализ модели}

Каждой функции энергии, описывающей модель позы человека, соответствует марковская сеть. От её свойств зависит сложность алгоритмов поиска оптимального значения модели. В общем случае поиск глобального оптимума в графических моделях осуществляется алгоритмом распространения доверия. Его вычислительная сложность зависит от количества допустимых состояний минимальной группы вершин, разделяющих графическую модель на две части. Если графическая модель является деревом, то сложность алгоритма квадратично зависит от количества допустимых состояний для каждой вершины. Примером такой графической модели является модель позы человека на изображении при условии известного параметра масштаба. Специальный вид парных потенциалов, позволил сократить сложность вывода в графической модели до линейной зависимости от количества допустимых положений суставов на изображении.

К сожалению, при расширении этой модели, в марковской сети появляются циклы, а следовательно сложность поиска оптимального решения существенно возрастает. На рисунке \ref{} представлена графическая модель, соответствующая модели \cite{park2011n}. Её можно рассматривать как марковскую цепь первого порядка, где каждое состояние описывается множеством вершин одного кадра.

Рассмотрим вычислительную сложность алгоритма поиска глобального минимума для такой марковской цепи. Если на кадре имеется $M$ возможных положений каждого сустав, то сложность алгоритма распространения доверия равна $\mathcal{O}(M^{K}T)$. Здесь существенно использован факт, что модель движения \eqref{eq::motion_model} является квадратичной формой, и для вычисления сообщений в сети может быть использован метод дистантного преобразования. Таким образом, сложность поиска оптимального множества поз линейно зависит от количества возможных поз человека на изображении. Так как значение параметра $M$ может превосходить $10^4$, а количество суставов исчисляться десятками, то алгоритм поиска точного решения оказывается не применим на практике. Уменьшив количество допустимых поз на кадре изображения, авторы \cite{park2011n} построили алгоритм поиска локального оптимума со сложностью $\mathcal{O}(HT)$, где $H$ "--- количество допустимых поз на одном кадре.

Предложенная в данной работе модель является расширением \cite{park2011n} и содержит её в качестве частного случая. Алгоритм распространения правдоподобия не может быть применён для поиска глобального оптимума предложенной модели, так как потребует слишком больших вычислительных ресурсов. Также скрытое состояние $\Theta$ дополнительно содержит непрерывные параметры скорости суставов, то есть описанная модель является дискретно-непрерывной. Это не позволяет использовать алгоритм \cite{park2011n} напрямую.

Для описания предложенного алгоритма оптимизации важно рассмотреть две задачи, связанные с функцией представленной функции энергии:
\begin{enumerate}
	\item определение скорости суставов при известных позе и росте человека человека в видео "--- $\argmin_{V} E(P, \Theta)$;
	\item определение позы и размера человека на кадре $t$ при известных остальных параметрах модели "--- $\argmin_{P^t, s^t} E(P, \Theta)$.
\end{enumerate}

\subsubsection{Определение скорости}

Рассмотрим задачу определение скорости движения суставов при известных позе и росте человека в видео $V = \argmin_{V} E(P, \Theta)$. Модель позы человека на изображении $E_I(P^t, \Theta)$ и модель изменения размера $\eta^t(s^{t+1}, s^t)$ не зависят от параметров скорости. Поэтому рассматриваемая задача эквивалентна задаче оптимизации:
\begin{equation}
	V = \argmin_V E(V|P, \Theta_{\backslash V}) = \argmin_V {\sum_{i=1}^K\left(\psi^0_i(v^1_i) + \sum_{t=1}^{T-1}\psi_i^t(h_i^{t+1}, h_i^{t}, \Theta) \right)}
\end{equation}
Из этой формы видно, что скорости разных суставов никогда не входят в одно слагаемое, а значит можно проводить оптимизацию скорости каждого сустава независимо:
\begin{equation}
	\begin{aligned}
		V_i &= \argmin_{V_i} \psi^0_i(v^1_i) + \sum_{t=1}^{T-1}\psi_i^t(h_i^{t+1}, h_i^{t}, \Theta) \\
		V &= \cup_{i=1}^K V_i
	\end{aligned}
\end{equation}

Рассмотрим поиск оптимального значения для скорости одного сустава. В дальнейшем для упрощения выкладок я буду опускать индекс текущего сустава. Учитывая \eqref{eq::temp} и \eqref{eq::sigma}, оптимизируемую энергию $E(V|P, \Theta_{\backslash V})$ можно переписать в виде суммы унарных и парных потенциалов:
\begin{equation}
	\begin{aligned}
		E(V|P, \Theta_{\backslash V}) &= \psi^0(v^1) + \sum_{t=1}^{T-1} \left( \psi^{t,u}(v^t|p^{t+1}, p^{t}, s^t) + \psi^{t,p}(v^{t+1}, v^{t}|s^t) \right) \\		
		\psi^{t,u}(v^t|p^{t+1}, p^{t}, s^t) &= \frac{(\Delta p^t - A^u v^t)^T {\Sigma_p^p}^{-1} (\Delta p^t - A^u v^t)} {2 {s^t}^2} \\
		\psi^{t,p}(v^{t+1}, v^{t}|s^t) &= -\frac{(v^{t+1} - A^p v^t)^T {\Sigma_p^v}^{-1} (v^{t+1} - A^p v^t)} {2 {s^t}^2} \\ 
		\Delta p^t &= p^{t+1} - A_p^u p^t \\
		A &= \left[
		\begin{array}{c|c}
		A_p^u  & A^u \\ \hline
		\Theta & A^p
		\end{array}
		\right] \quad
		A_p^u, A^u, A^p \in \mathbb{R}^{2 \times 2}
	\end{aligned}
\end{equation}

В данной постановке задача поиска минимума функции энергии $E(V|P, \Theta_{\backslash V})$ совпадает с задачей определения состояний линейной динамической системы (ЛДС):
\begin{equation}
\begin{aligned}
V &= \argmax_V {p\left(V | \left\{\Delta p^t
	\right\}_{t=1}^{T-1}\right)} \\ 
\Delta p^t &\sim N(A^u v^t, (s^t)^2\Sigma_p^p) \\
v^{t+1} &\sim N(A^p v^t, (s^t)^2\Sigma_p^v) \\
v^1 &\sim N(\Theta, (s^t)^2\Sigma_p^{v^1}) \\
v^T &= A^p v^{T-1}
\end{aligned}
\end{equation}

Наиболее вероятная конфигурация $V$ при известных значениях $\left\{\Delta p^t\right\}_{t=1}^{T-1}$ определяется математическим ожиданием нормального распределения $p\left(V| \left\{\Delta p^t\right\}_{t=1}^{T-1} \right)$. Рассмотрим маргинальное распределение $p(v^t|\left\{\Delta p^t\right\}_{t=1}^{T-1}) = N(v^t | \mu^t, \Sigma^t)$. Математическое ожидание $p(v^t|\left\{\Delta p^t\right\}_{t=1}^{T-1})$ определяется соответствующей компонентой математического ожидания распределения $p(V|\left\{\Delta p^t\right\}_{t=1}^{T-1})$. Таким образом, значения маргинальных распределений $p(v^t|\left\{\Delta p^t\right\}_{t=1}^{T-1})$ позволяют найти и наиболее вероятную конфигурацию всех скрытых переменных модели $V$. Для поиска наиболее вероятной конфигурации мы используем фильтр Калмана и РТС уравнения.

Априорное распределение скорости сустава в начальный момент времени мы моделируем с помощью нормального распределения с дисперсией стремящейся к бесконечности. Таким образом, мы моделируем отсутствие априорных предпочтений относительно скорости сустава. Поэтому в фильтре Калмана формулы изменятся следующим образом:
\begin{multline}
	K_1 = \Sigma_0 A^{uT}\left(A^u \Sigma_0 A^{uT} + \Sigma_p^p\right)^{-1} =
	\sigma_0 I_{2\times2} A^{uT} \left(A^u \sigma_0 I_{2\times2} A^{uT} +
	\Sigma_p^p\right)^{-1} = \\ = 
	A^{uT} \left(A^u A^{uT} + \frac{1}{\sigma_0}\Sigma_p^p\right)^{-1} \rightarrow
	A^{uT} \left(A^u A^{uT}\right)^{-1}
\end{multline}
\[
\hat{\mu}_1^j = \mu_0 + K_1 \left( \Delta \overline{POS}_1^j - A^u \mu_0 \right) =
K_1 \Delta \overline{POS}_1^j
\]
\begin{multline}
	\hat{\Sigma}_1^j = \left(I - K_1 A^u \right) \Sigma_0 = \\ =
	\left(\left(A^{uT} A^u\right)^{-1} A^{uT} A^u - \Sigma_0 A^{uT}
	\left( A^u \Sigma_0 A^{uT} + \Sigma_p^p \right)^{-1} A^u \right) \Sigma_0 = \\ =
	\left(\left(A^{uT} A^u\right)^{-1} A^{uT} \left( A^u \Sigma_0 A^{uT} + \Sigma_p^p \right)
	- \Sigma_0 A^{uT}\right)
	\left( A^u \Sigma_0 A^{uT} + \Sigma_p^p \right)^{-1} A^u \Sigma_0 = \\ =
	\left(A^{uT} A^u\right)^{-1} A^{uT} \Sigma_p^p
	\left( A^u \Sigma_0 A^{uT} + \Sigma_p^p \right)^{-1} A^u \Sigma_0 = \\ =
	\left(A^{uT} A^u\right)^{-1} A^{uT} \Sigma_p^p
	\left(A^u A^{uT} + \frac{1}{\sigma_0} \Sigma_p^p \right)^{-1} A^u \rightarrow
	\left(A^{uT} A^u\right)^{-1} A^{uT} \Sigma_p^p \left(A^u A^{uT}\right)^{-1} A^u
\end{multline}

Значения $\overline{V}_i^j$ можно эффективно найти с помощью алгоритма <<вперед-назад>> для ЛДС \ref{alg:velocity}. Тогда $V_i^j|\Delta\overline{POS}^j \sim N\left(S_i\mu_i^j, S_i^2 \Sigma_i^j \right)$
\begin{algorithm}[!t]
	\KwData{$\Delta \overline{POS}_1^j, \dots, \Delta \overline{POS}_{N-1}^j$ "--- наблюдаемые данные, $(A^u, A^p, \Sigma_p^p, \Sigma_p^v)$ "--- параметры модели}
	\KwResult{$\mu_1^j, \dots, \mu_{N}^j, \Sigma_1^j, \dots, \Sigma_N^j$}
	
	// фильтр Калмана\;
	$K_1 = A^{uT} \left(A^u A^{uT}\right)^{-1}$\;
	$\hat{\mu}_1^j = K_1 \Delta \overline{POS}_1^j $\;
	$\hat{\Sigma}_1^j =
	\left(A^{uT} A^u\right)^{-1} A^{uT} \Sigma_p^p \left(A^u A^{uT}\right)^{-1} A^u$ \;
	\For{i = 2,\dots, N-1}{
		$\tilde{\Sigma}_{i-1} = A^p \hat{\Sigma}_{i-1}^j A^{pT} + \Sigma_p^v$\;
		$K_{i} = \tilde{\Sigma}_{i-1} A^{uT} (A^u \tilde{\Sigma}_{i-1} A^{uT} + \Sigma_p^p)^{-1}$\;
		$\hat{\mu}_i^j = A^p \hat{\mu}_{i-1}^j + K_i \left( \Delta \overline{POS}_i^j -
		A^u A^p \hat{\mu}_{i-1}^j \right)$\;
		$\hat{\Sigma}_i^j = (I - K_{i} A^u) \tilde{\Sigma}_{i-1}$ \;
	}
	
	// РТС уравнения
	$\mu_{N-1}^j = \hat{\mu}_{N-1}^j$\;
	$\Sigma_{N-1}^j = \hat{\Sigma_{N-1}^j}$\;
	\For {i = N-2,\dots,1}{
		$K_i=\hat{\Sigma}_i^j A^p \tilde{\Sigma}_i^{-1}$\;
		$\mu_i^j = \hat{\mu}_i^j + K_i(\mu_{i+1}^j - A^p \hat{\mu}_i^j)$\;
		$\Sigma_i^j = \hat{\Sigma}_i^j + K_i (\Sigma_{i+1}^j - \tilde{\Sigma}_i^j)K_i^T$\;
	}
	$\mu_N = A^p \mu_{N-1}^j$\;
	$\Sigma_N^j = \Sigma_p^v + A^p \Sigma_{N-1}^j A^{pT}$\;
	\caption{Алгоритм определения скорости сустава $V^j$.} \label{alg:velocity}
\end{algorithm}

\subsubsection{Определение позы и размера на кадре}

\subsection{Предложенный метод}

Алгоритм поиска оптимального решения рассматриваемой функции энергии имеет вычислительную сложность, не допускающую использование его на практике. Также указанная функция энергии содержит непрерывные и дискретные параметры. Я предложил два алгоритма поиска оптимального значения построенной функции энергии. Первый алгоритм использует идею работы \cite{park2011n} для поиска локального оптимума, а второй "--- метод сэмплирования из распределения для уточнения результата.

Рассмотрим первый из предложенных алгоритмов. Его псевдокод представлен на листинге \ref{alg:generalInit}. 

\begin{algorithm}[t]
	\SetAlgoLined %% Это соединяет линиями логические части 
	%% алгоритма типа if-then-else
	
	\KwData{ $I, K$} %% здесь можно указать исходные параметры
	
	\KwResult{ $P$ } %% результат работы программы
	
	$r \leftarrow \max(I.width(), I.height())$;
	
	$\overline{P} \leftarrow N\_best(I|r)$;
	
	$\overline{V} \leftarrow \argmin{E(V|\overline{P})}$;
	
	\While{ $r > 1$ }{
		
		$t \leftarrow randint(N)$;
		
		$\left\{h_k^p\right\} \leftarrow N\_best\left(I_t | \overline{P}_{\setminus t}, \overline{V}, \right)$;
		
		\For{$k=\overline{1,K}$}{
			
			$H_k^p \leftarrow \left\{\overline{P}_{\setminus t}, h_k^p\right\}$;
			
			$H_k^v \leftarrow \argmin {E(V|H_k^p)}$;
		}
		
		$\left(\widehat{P}, \widehat{V}\right) = \argmin{\left\{E(H_k^p, H_k^v)\right\}}$;
		
		\If{$E(\widehat{P}, \widehat{V}) = E(\overline{P}, \overline{H})$}{
			
			$r \leftarrow \frac{r}{2}$;
			
		}
		
		$\overline{P} \leftarrow \widehat{P}$;
		
		$\overline{V} \leftarrow \widehat{V}$;
		
	}
	
	return $\overline{P}$;
	
	\caption{Итеративный алгоритм построения позы человека в видео.}
	\label{alg:generalInit}
\end{algorithm}

 Поэтому я предложил итеративный алгоритм поиска локального оптимума. Он сводится к последовательному решению двух задач: 1) определении множества наилучших гипотез позы человека на изображении и 2) оценки скорости движения людей. Предложенный алгоритм основан на последовательной оптимизации групп неизвестных параметров при фиксации остальных.

Допустим, что поза и размер человека зафиксированы на всех кадрах кроме кадра $I_i$.

Предложенный алгоритм базируется на том, что при известных значениях части параметров
\begin{itemize}
	\item если известно оптимальное значение позы и размера человека на всех кадрах, то существует эффективный алгоритм поиска оптимального значения остальных параметров;
	\item если известно оптимальное значение позы и размера человека на всех кадрах, кроме одного, а также известно оптимальное значение скорости его суставов, то существует алгоритм поиска оптимального значения параметров на оставшемся кадре.
\end{itemize}



\begin{algorithm}[H]
	\SetAlgoLined %% Это соединяет линиями логические части 
	%% алгоритма типа if-then-else
	
	\KwData{ $I, \tilde{P}, N$} %% здесь можно указать исходные параметры
	
	\KwResult{ $P$ } %% результат работы программы
	
	$\tilde{V} \leftarrow \argmax{E(V|\tilde{P})}$;
	
	$H_0 \leftarrow \left(\tilde{P}, \tilde{V} \right)$;
	
	\For{$i=\overline{1,N}$}{
		
		$i \leftarrow sample\_step()$;
		
		$\widehat{P} \leftarrow apply\_step(H_{i-1}, k)$;
		
		$\widehat{V} \leftarrow \argmin{E(V|\widehat{P})}$;
		
		$H_i \leftarrow choose\_next(H_{i-1}, (\widehat{P}, \widehat{V}))$;
		
	}

	$P \leftarrow \argmin_i{E(H_i)}$;
	
	\caption{Алгоритм сэмплирования для построения позы человека в видео.}
	\label{alg:generalHM}
\end{algorithm}

\subsection{Доказательство сходимости}
\subsection{Доказательство корректности}
\subsection{Оценка сложности}
\section{Экспериментальная оценка}
\subsection{Описание тестовых данных}
\subsection{Анализ результатов}
